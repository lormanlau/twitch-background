{"version":3,"sources":["logo.svg","App.js","reportWebVitals.js","index.js"],"names":["clientId","getRandomInt","Math","floor","random","App","useState","ready","setReady","demo","setDemo","connected","setConnected","_authUrl","setAuthUrl","r","g","b","left","setLeft","right","setRight","ws","useRef","useEffect","clock","setInterval","clearInterval","authUrl","useCallback","sessionStorage","twitchOAuthState","nonce","length","text","possible","i","charAt","listen","channelId","message","type","data","topics","auth_token","twitchOAuthToken","console","log","Date","toLocaleString","current","send","JSON","stringify","heartbeat","connect","heartbeatHandle","WebSocket","onopen","event","onerror","error","onmessage","parse","fetch","headers","Authorization","then","res","json","id","setTimeout","rgbValue","hex","result","exec","parseInt","hexToRgb","redemption","user_input","reward","title","includes","onclose","document","location","hash","match","hashMatch","expr","state","parseFragment","className","style","background","display","href","src","logo","alt","xmlns","viewBox","preserveAspectRatio","shapeRendering","d","x","y","fill","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.a4e16531.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logo.6ce24c58.svg\";","import logo from \"./logo.svg\";\nimport './App.css';\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\n\nconst clientId = 'jzrppcr9rjx38gwy84w3v6s56t0v2t';\nconst redirectURI = 'https://lormanlau.github.io/twitch-background/';\nconst scope = 'channel:read:redemptions%20user:read:email';\n\nconst getRandomInt = () => {\n  return Math.floor(Math.random() * 256);\n}\n\nconst hexToRgb = (hex) => {\n  var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  return result ? {\n    r: parseInt(result[1], 16),\n    g: parseInt(result[2], 16),\n    b: parseInt(result[3], 16)\n  } : {\n    r: 0,\n    g: 0,\n    b: 0\n  }\n}\n\nfunction App() {\n  const [ready, setReady] = useState(false);\n  const [demo, setDemo] = useState(true);\n  const [connected, setConnected] = useState(false);\n  const [_authUrl, setAuthUrl] = useState(\"/twitch-background\");\n  const [left, setLeft] = useState({ r: 84, g: 58, b: 183 })\n  const [right, setRight] = useState({ r: 0, g: 172, b: 193 })\n  var ws = useRef()\n\n  /* for testing to generate random colors */\n  useEffect(() => {\n    let clock;\n    if (demo) {\n      clock = setInterval(() => {\n        setLeft({ r: getRandomInt(), g: getRandomInt(), b: getRandomInt() })\n        setRight({ r: getRandomInt(), g: getRandomInt(), b: getRandomInt() })\n      }, 5000);\n    }\n    return (() => { clearInterval(clock) })\n  }, [demo])\n\n\n  var parseFragment = (hash) => {\n    var hashMatch = function (expr) {\n      var match = hash.match(expr);\n      return match ? match[1] : null;\n    };\n    var state = hashMatch(/state=(\\w+)/);\n    if (sessionStorage.twitchOAuthState === state)\n      sessionStorage.twitchOAuthToken = hashMatch(/access_token=(\\w+)/);\n  };\n\n  var authUrl = useCallback(() => {\n    sessionStorage.twitchOAuthState = nonce(15);\n    var url = 'https://id.twitch.tv/oauth2/authorize' +\n      '?response_type=token' +\n      '&client_id=' + clientId +\n      '&redirect_uri=' + redirectURI +\n      '&state=' + sessionStorage.twitchOAuthState +\n      '&scope=' + scope;\n    return url\n  }, [])\n\n  var getUserId = () => {\n    return fetch(\"https://api.twitch.tv/helix/users\", {\n      headers: {\n        Authorization: `Bearer ${sessionStorage.twitchOAuthToken}`,\n        \"Client-Id\": clientId\n      }\n    })\n      .then(res => res.json())\n      .then(data => data.data[0].id)\n  }\n\n  var nonce = (length) => {\n    var text = \"\";\n    var possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n    for (var i = 0; i < length; i++) {\n      text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n    return text;\n  }\n  var listen = useCallback((channelId) => {\n    let message = {\n      type: 'LISTEN',\n      nonce: nonce(15),\n      data: {\n        topics: [`channel-points-channel-v1.${channelId}`],\n        auth_token: sessionStorage.twitchOAuthToken\n      }\n    };\n    console.log(new Date().toLocaleString(), 'SENT:', message);\n    ws.current.send(JSON.stringify(message));\n  }, []);\n\n  var heartbeat = () => {\n    let message = {\n      type: 'PING'\n    }\n    ws.current.send(JSON.stringify(message));\n  }\n\n  var connect = useCallback(() => {\n    var heartbeatInterval = 1000 * 60;\n    var reconnectInterval = 1000 * 3;\n    var heartbeatHandle;\n\n    ws.current = new WebSocket('wss://pubsub-edge.twitch.tv');\n\n    ws.current.onopen = function (event) {\n      console.log(new Date().toLocaleString(), 'INFO: Socket Opened');\n      heartbeat();\n      heartbeatHandle = setInterval(heartbeat, heartbeatInterval);\n    };\n\n    ws.current.onerror = function (error) {\n      console.error(new Date().toLocaleString(), 'ERR:', error);\n    };\n\n    ws.current.onmessage = function (event) {\n      let message = JSON.parse(event.data);\n      console.log(new Date().toLocaleString(), 'RECV:', message);\n      if (message.type === \"PONG\") {\n        if (!connected) {\n          getUserId()\n            .then((channelId) => {\n              listen(channelId)\n              setConnected(true);\n            })\n        }\n      }\n      if (message.type === 'RECONNECT') {\n        console.log(new Date().toLocaleString(), 'INFO: Reconnecting...');\n        setTimeout(connect, reconnectInterval);\n      }\n      if (message.type === 'reward-redeemed') {\n        let color = message.data.redemption.user_input\n        let rgbValue = hexToRgb(color)\n        if (message.data.reward.title.includes(\"left\")) {\n          setLeft(rgbValue);\n        } else if (message.reward.title.includes(\"right\")) {\n          setRight(rgbValue);\n        }\n      }\n    };\n\n    ws.current.onclose = function () {\n      console.log(new Date().toLocaleString(), 'INFO: Socket Closed');\n      clearInterval(heartbeatHandle);\n      console.log(new Date().toLocaleString(), 'INFO: Reconnecting...');\n      setTimeout(connect, reconnectInterval);\n      setConnected(false)\n    };\n\n  }, [connected, ws, listen])\n\n  useEffect(() => {\n    if (document.location.hash.match(/access_token=(\\w+)/))\n      parseFragment(document.location.hash);\n    if (sessionStorage.twitchOAuthToken) {\n      connect();\n      setReady(true)\n      setDemo(false)\n    } else {\n      setAuthUrl(authUrl());\n      setReady(false)\n    }\n  }, [authUrl, connect]);\n\n  return (\n    <div className=\"header\" style={{ background: `linear-gradient(60deg, rgba(${left.r},${left.g},${left.b}) 0%, rgba(${right.r},${right.g},${right.b}) 100%)` }}>\n      <div className=\"inner-header flex\">\n        <div className=\"container\">\n          <div className=\"row\">\n            <div style={{ display: ready ? \"none\" : \"block\" }} className=\"auth text-center\">\n              <p>First, connect with your Twitch Account:</p>\n              <a id=\"auth-link\" href={_authUrl}><img src={logo} alt=\"logo\" /></a>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div>\n        <svg className=\"waves\" xmlns=\"http://www.w3.org/2000/svg\"\n          viewBox=\"0 24 150 28\" preserveAspectRatio=\"none\" shapeRendering=\"auto\">\n          <defs>\n            <path id=\"gentle-wave\" d=\"M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z\" />\n          </defs>\n          <g className=\"parallax\">\n            <use href=\"#gentle-wave\" x=\"48\" y=\"0\" fill=\"rgba(255,255,255,0.7\" />\n            <use href=\"#gentle-wave\" x=\"48\" y=\"3\" fill=\"rgba(255,255,255,0.5)\" />\n            <use href=\"#gentle-wave\" x=\"48\" y=\"5\" fill=\"rgba(255,255,255,0.3)\" />\n            <use href=\"#gentle-wave\" x=\"48\" y=\"7\" fill=\"#fff\" />\n          </g>\n        </svg>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}